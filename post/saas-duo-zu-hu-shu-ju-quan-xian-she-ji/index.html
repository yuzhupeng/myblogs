<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>Saas多租户数据权限设计 | fishyue</title>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://yuzhupeng.top/myblogs//favicon.ico?v=1755503043926">
<link rel="stylesheet" href="https://yuzhupeng.top/myblogs//styles/main.css">



<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>



    <meta name="description" content="Saas多租户数据权限设计（参考RuoYi）
最近公司打算把内部的系统打造成商业化的Saas产品，我们组承担了产品的研发任务。
理论上，这套系统在我们公司内部的业务中已经打磨了5年+，对于我们这个细分行业来说已经是非常成熟了，只需要稍加改造..." />
    <meta name="keywords" content="" />
  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://yuzhupeng.top/myblogs/">
        <img src="https://yuzhupeng.top/myblogs//images/avatar.png?v=1755503043926" class="site-logo">
        <h1 class="site-title">fishyue</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/myblogs" class="site-nav">
            首页
          </a>
        
      
        
          <a href="/myblogs/archives" class="site-nav">
            归档
          </a>
        
      
        
          <a href="/myblogs/tags" class="site-nav">
            标签
          </a>
        
      
        
          <a href="/myblogs/post/about" class="site-nav">
            关于
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
          <a class="social-link" href="https://github.com/yuzhupeng" target="_blank">
            <i class="fab fa-github"></i>
          </a>
        
      
        
      
        
      
        
      
        
      
    </div>
    <div class="site-description">
      由奢入俭难，由俭入奢易
    </div>
    <div class="site-footer">
      Powered by <a href="https://github.com/yuzhupeng" target="_blank">Fishyue</a> | <a class="rss" href="https://yuzhupeng.top/myblogs//atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">Saas多租户数据权限设计</h2>
            <div class="post-date">2025-08-04</div>
            
            <div class="post-content" v-pre>
              <p>Saas多租户数据权限设计（参考RuoYi）</p>
<p>最近公司打算把内部的系统打造成商业化的Saas产品，我们组承担了产品的研发任务。</p>
<p>理论上，这套系统在我们公司内部的业务中已经打磨了5年+，对于我们这个细分行业来说已经是非常成熟了，只需要稍加改造，适配多租户模式即可。</p>
<p>但是，真正落实到项目架构设计中，才发现有很多需要重新梳理和考虑的地方。</p>
<h3 id=""><a href="#%E5%AF%BC%E8%88%AA"></a>导航</h3>
<ul>
<li>引子</li>
<li>场景梳理</li>
<li>基于角色的访问控制（RBAC）</li>
<li>多租户系统的权限设计</li>
<li>RuoYi系统的数据权限设计</li>
<li>最终设计方案</li>
<li>参考</li>
</ul>
<h3 id="-2"><a href="#%E5%BC%95%E5%AD%90"></a>引子</h3>
<p>最近公司打算把内部的系统打造成商业化的Saas产品，我们组承担了产品的研发任务。</p>
<p>理论上，这套系统在我们公司内部的业务中已经打磨了5年+，对于我们这个细分行业来说已经是非常成熟了，只需要稍加改造，适配多租户模式即可。</p>
<p>但是，真正落实到项目架构设计中，才发现有很多需要重新梳理和考虑的地方。</p>
<p>今天，主要是针对<strong>数据权限</strong>这块的设计和大家分享一下。</p>
<h3 id="-3"><a href="#%E5%9C%BA%E6%99%AF%E6%A2%B3%E7%90%86"></a>场景梳理</h3>
<blockquote>
<p>脱离场景的设计总是显得空洞。</p>
</blockquote>
<p>在IM聊天场景中，有个很重要功能是，每个用户都要查看自己的会话（聊天记录）。</p>
<p>比如，</p>
<ul>
<li>普通咨询师可能就只能查看自己的聊天</li>
<li>主管可以查看组员咨询师的聊天</li>
<li>CEO可以查看所有咨询师的聊天</li>
<li>...</li>
</ul>
<p>这样的需求在我们的系统中应该如何实现呢？</p>
<h3 id="-4"><a href="#%E5%9F%BA%E4%BA%8E%E8%A7%92%E8%89%B2%E7%9A%84%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6rbac"></a>基于角色的访问控制（RBAC）</h3>
<p>基于角色的访问控制（Role-based access control，简称 RBAC），指的是通过用户的角色（Role）授权其相关权限，这实现了更灵活的访问控制，相比直接授予用户权限，要更加简单、高效、可扩展。</p>
<figure data-type="image" tabindex="1"><a href="https://cdn.authing.co/authing-docs-v2/1.4.20/assets/img/rbac.60e79b81.png"><img src="https://cdn.authing.co/authing-docs-v2/1.4.20/assets/img/rbac.60e79b81.png" alt="" loading="lazy"></a></figure>
<p>当使用 RBAC 时，通过分析系统用户的实际情况，基于共同的职责和需求，授予他们不同角色。你可以授予给用户一个或多个角色，每个角色具有一个或多个权限，这种 用户-角色、角色-权限 间的关系，让我们可以不用再单独管理单个用户，用户从授予的角色里面继承所需的权限。</p>
<h3 id="-5"><a href="#%E5%A4%9A%E7%A7%9F%E6%88%B7%E7%B3%BB%E7%BB%9F%E7%9A%84%E6%9D%83%E9%99%90%E8%AE%BE%E8%AE%A1"></a>多租户系统的权限设计</h3>
<p>一般来说，我们会将用户的权限分为菜单权限和数据权限。</p>
<p>菜单权限：控制用户能看到那些菜单或者按钮。</p>
<p>数据权限：控制用户能看到的数据范围。</p>
<p>在开始设计之前，我们可以看看用户登录+授权的过程，在用户返回的信息中就会包含角色（roleCodes）、菜单（permCodes）和数据权限（dataCodes）信息。</p>
<figure data-type="image" tabindex="2"><a href="https://img.zhikestreet.com/17294890486213.png"><img src="https://img.zhikestreet.com/17294890486213.png" alt="" loading="lazy"></a></figure>
<p>所以，角色（roleCodes）、菜单（permCodes）和数据权限（dataCodes）就是需要我们提前设计好的。</p>
<p>根据IM自身的业务，我们对角色的设计如下：</p>
<ul>
<li>咨询师（counselor_role）</li>
<li>主管（manager_role）</li>
<li>管理员（admin_role）</li>
</ul>
<p>菜单权限：</p>
<ul>
<li>账号管理（zhanghaoguanli）</li>
<li>公共设置（gonggongshezhi）</li>
<li>...（根据实际情况定义）</li>
</ul>
<p>令人头疼的其实是数据权限的设计，我们期望定义一种通用的数据权限。</p>
<p>所以，这里就不得不提到<a href="https://ruoyi.vip/">RuoYi系统</a>。</p>
<h4 id="-6"><a href="#ruoyi%E7%B3%BB%E7%BB%9F%E7%9A%84%E6%95%B0%E6%8D%AE%E6%9D%83%E9%99%90%E8%AE%BE%E8%AE%A1"></a>RuoYi系统的数据权限设计</h4>
<p>在无意间，看到了一篇介绍RuoYi系统数据权限设计分析的文章- <a href="https://blog.csdn.net/m0_52134610/article/details/124122393">《深入分析若依数据权限@datascope （注解+AOP+动态sql拼接） 【循序渐进，附分析过程】》</a>。</p>
<p>于是，笔者对这个开源系统进行了体验。(点此处直达)[<a href="https://demo.ruoyi.vip/index">https://demo.ruoyi.vip/index</a>]</p>
<p>登录RuoYi系统后台，映入眼帘的是一堆的大家再熟悉不过的系统菜单。</p>
<ul>
<li>系统管理<p></p><p></p><ul><li>用户管理</li><li>角色管理</li><li>菜单管理</li><li>部门管理</li><li>岗位管理</li><li>字典管理</li><li>...</li></ul></li>
</ul>
<p>这里重点查看<code>角色管理</code>菜单，在列表的<strong>操作</strong>一栏，可以看到有个<strong>更多</strong>按钮，展开<strong>更多</strong>按钮，<strong>数据权限</strong>按钮暴露出来。</p>
<figure data-type="image" tabindex="3"><a href="https://img.zhikestreet.com/20241022213343.png"><img src="https://img.zhikestreet.com/20241022213343.png" alt="" loading="lazy"></a></figure>
<p>点击<strong>数据权限</strong>按钮，就可以看到数据权限配置窗口。</p>
<figure data-type="image" tabindex="4"><a href="https://img.zhikestreet.com/20241022214945.png"><img src="https://img.zhikestreet.com/20241022214945.png" alt="" loading="lazy"></a></figure>
<p>在这里可以看到数据权限分类如下：</p>
<ul>
<li>全部数据权限</li>
<li>自定义数据权限</li>
<li>本部门数据权限</li>
<li>本部门及以下数据权限</li>
<li>仅本人数据权限</li>
</ul>
<p>可以看到这里的数据权限都是基于组织架构设计的。</p>
<p>需要指出的是，这里的<strong>自定义数据权限</strong>其实也是基于组织架构的选择，只是可以自由选择（比如适配跨部门场景）。</p>
<p>总体来讲，RuoYi系统数据权限的设计是<strong>中规中矩</strong>的，应该属于比较通用的设计。</p>
<p>这也是我们目前的商业化项目设计中值得借鉴的。</p>
<h3 id="-7"><a href="#%E6%9C%80%E7%BB%88%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88"></a>最终设计方案</h3>
<figure data-type="image" tabindex="5"><a href="https://img.zhikestreet.com/20241022221103.png"><img src="https://img.zhikestreet.com/20241022221103.png" alt="" loading="lazy"></a></figure>
<h3 id="-8"><a href="#%E5%8F%82%E8%80%83"></a>参考</h3>
<ul>
<li><a href="https://docs.authing.co/v2/guides/access-control/choose-the-right-access-control-model.html#%E4%BB%80%E4%B9%88%E6%98%AF%E5%9F%BA%E4%BA%8E%E8%A7%92%E8%89%B2%E7%9A%84%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6-rbac" target="_blank">《什么是基于角色的访问控制（RBAC）》</a></li>
<li><a href="https://ruoyi.vip/" target="_blank">ruoyi官网</a></li>
<li><a href="https://gitcode.com/yangzongzhuan/RuoYi-Vue/overview" target="_blank">《RuoYi-Vue 源码》</a></li>
<li><a href="https://blog.csdn.net/m0_52134610/article/details/124122393" target="_blank">《深入分析若依数据权限@datascope （注解+AOP+动态sql拼接） 【循序渐进，附分析过程】》</a></li>
</ul>
<figure data-type="image" tabindex="6"><a href="https://img.zhikestreet.com/paycode.png"><img src="https://img.zhikestreet.com/paycode.png" alt="" loading="lazy"></a></figure>

            </div>
            
            
              <div class="next-post">
                <div class="next">下一篇</div>
                <a href="https://yuzhupeng.top/myblogs/post/vue-he-xin-bi-ji/">
                  <h3 class="post-title">
                    Vue核心 笔记
                  </h3>
                </a>
              </div>
            

            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
<script type="application/javascript">

AOS.init();

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>






  </body>
</html>
